<!DOCTYPE html>
<html lang="fr">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Conciergerie ‚Äì Gestion des missions</title>
  <link rel="preconnect" href="https://fonts.googleapis.com" />
  <link href="https://fonts.googleapis.com/css2?family=Fraunces:wght@400;600;700&family=DM+Sans:wght@400;500;600&family=DM+Mono:wght@400;500&display=swap" rel="stylesheet" />
  <script src="https://cdnjs.cloudflare.com/ajax/libs/react/18.2.0/umd/react.production.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/react-dom/18.2.0/umd/react-dom.production.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/babel-standalone/7.23.2/babel.min.js"></script>
  <style>
    * { box-sizing: border-box; margin: 0; padding: 0; }
    body { background: #0f1117; color: #e8eaf2; font-family: 'DM Sans', sans-serif; }
    ::-webkit-scrollbar { width: 6px; }
    ::-webkit-scrollbar-track { background: transparent; }
    ::-webkit-scrollbar-thumb { background: #2a2f45; border-radius: 3px; }
    select option { background: #1a1d27; }
    a { text-decoration: none; }
  </style>
</head>
<body>
<div id="root"></div>
<script type="text/babel">
const { useState, useEffect } = React;

const C = {
  bg: "#0f1117", surface: "#1a1d27", border: "#2a2f45",
  accent: "#4f8ef7", accentLight: "#7aaeff", accentMuted: "#1e2d4d",
  success: "#2dd4a0", successMuted: "#0d2e22",
  warning: "#f7a94f", danger: "#f75f5f",
  text: "#e8eaf2", textMuted: "#8891b0", textDim: "#5a6280",
};

const DEFAULT_PRESTS = [
  { id: "p1", nom: "Marie Dupont", email: "marie@example.com", couleur: "#4f8ef7" },
  { id: "p2", nom: "Thomas Bernard", email: "thomas@example.com", couleur: "#2dd4a0" },
];
const DEFAULT_LOGS = [
  { id: "l1", nom: "Villa Les Pins", adresse: "12 Rue des Mimosas, Antibes", codeAcces: "A1234#", notes: "" },
  { id: "l2", nom: "Appart Vue Mer", adresse: "8 Boulevard de la Plage, Nice", codeAcces: "B5678*", notes: "" },
];

function gcalUrl(m, prest, log) {
  const fmt = (d, t) => new Date(`${d}T${t||"09:00"}`).toISOString().replace(/[-:]/g,"").split(".")[0]+"Z";
  const title = encodeURIComponent(`üßπ M√©nage ‚Äì ${log?.nom||""}`);
  const details = encodeURIComponent([
    `üë§ ${prest?.nom||""}`,
    `üîë Code : ${log?.codeAcces||""}`,
    m.heureDepart ? `üõ´ D√©part locataires : ${m.heureDepart}` : "",
    m.dateArrivee ? `üõ¨ Arriv√©e prochains locataires : ${m.dateArrivee}${m.heureArrivee?" √† "+m.heureArrivee:""}` : "",
    m.cout ? `üí∂ Co√ªt : ${m.cout}` : "",
    m.consignes ? `üìù ${m.consignes}` : "",
  ].filter(Boolean).join("\n"));
  return `https://calendar.google.com/calendar/render?action=TEMPLATE&text=${title}&dates=${fmt(m.date,m.heureMission)}/${fmt(m.date,m.heureMission)}&details=${details}&location=${encodeURIComponent(log?.adresse||"")}`;
}

function generateIcal(missions, prest, logs) {
  const esc = s => (s||"").replace(/[,;\\]/g,"\\$&").replace(/\n/g,"\\n");
  const fmt = (d,t) => new Date(`${d}T${t||"09:00"}`).toISOString().replace(/[-:]/g,"").split(".")[0]+"Z";
  const events = missions.filter(m=>m.prestataireId===prest.id).map(m=>{
    const log = logs.find(l=>l.id===m.logementId);
    const desc = [
      `üìç ${log?.adresse||""}`, `üîë ${log?.codeAcces||""}`,
      m.heureDepart?`üõ´ D√©part locataires : ${m.heureDepart}`:"",
      m.dateArrivee?`üõ¨ Arriv√©e prochains locataires : ${m.dateArrivee}${m.heureArrivee?" √† "+m.heureArrivee:""}`:"",
      m.cout?`üí∂ Co√ªt : ${m.cout}`:"",
      m.consignes?`üìù ${m.consignes}`:"",
    ].filter(Boolean).join("\\n");
    return ["BEGIN:VEVENT",`UID:${m.id}@conciergerie`,
      `DTSTAMP:${new Date().toISOString().replace(/[-:]/g,"").split(".")[0]}Z`,
      `DTSTART:${fmt(m.date,m.heureMission)}`,`DTEND:${fmt(m.date,m.heureMission)}`,
      `SUMMARY:${esc(`üßπ M√©nage ‚Äì ${log?.nom||""}`)}`,
      `DESCRIPTION:${esc(desc)}`,`LOCATION:${esc(log?.adresse||"")}`,
      "END:VEVENT"].join("\r\n");
  });
  return ["BEGIN:VCALENDAR","VERSION:2.0","PRODID:-//Conciergerie//FR",
    `X-WR-CALNAME:Missions ‚Äì ${prest.nom}`,"CALSCALE:GREGORIAN","METHOD:PUBLISH",
    ...events,"END:VCALENDAR"].join("\r\n");
}

function downloadIcal(content, filename) {
  const blob = new Blob([content], {type:"text/calendar;charset=utf-8"});
  const url = URL.createObjectURL(blob);
  const a = document.createElement("a");
  a.href=url; a.download=filename; a.click(); URL.revokeObjectURL(url);
}

// -- UI --
const label_style = { fontSize:12, color:C.textMuted, fontFamily:"'DM Mono',monospace", textTransform:"uppercase", letterSpacing:"0.08em", display:"block", marginBottom:6 };

function Field({label, children}) {
  return <div style={{display:"flex",flexDirection:"column"}}><label style={label_style}>{label}</label>{children}</div>;
}

const inputStyle = { background:C.bg, border:`1px solid ${C.border}`, borderRadius:8, padding:"10px 14px", color:C.text, fontSize:14, fontFamily:"'DM Sans',sans-serif", outline:"none", width:"100%", boxSizing:"border-box" };

function Input({label,...props}) {
  return <Field label={label}><input {...props} style={{...inputStyle,...props.style}}
    onFocus={e=>e.target.style.borderColor=C.accent}
    onBlur={e=>e.target.style.borderColor=C.border} /></Field>;
}
function Textarea({label,...props}) {
  return <Field label={label}><textarea {...props} style={{...inputStyle,resize:"vertical",minHeight:80,...props.style}}
    onFocus={e=>e.target.style.borderColor=C.accent}
    onBlur={e=>e.target.style.borderColor=C.border} /></Field>;
}
function Select({label,children,...props}) {
  return <Field label={label}><select {...props} style={{...inputStyle,cursor:"pointer",...props.style}}>{children}</select></Field>;
}

function Btn({children, variant="primary", size="md", ...props}) {
  const vs = {
    primary:{background:C.accent,color:"#fff",border:"none"},
    secondary:{background:"transparent",color:C.textMuted,border:`1px solid ${C.border}`},
    success:{background:C.success,color:"#0a1f17",border:"none"},
    danger:{background:"transparent",color:C.danger,border:`1px solid ${C.danger}33`},
    gcal:{background:"#1a73e822",color:"#4f9ef8",border:"1px solid #1a73e844"},
  };
  const ss = { sm:{padding:"6px 12px",fontSize:12}, md:{padding:"10px 18px",fontSize:14}, lg:{padding:"13px 24px",fontSize:15} };
  return <button {...props} style={{borderRadius:8,fontFamily:"'DM Sans',sans-serif",fontWeight:600,cursor:"pointer",display:"inline-flex",alignItems:"center",gap:6,...vs[variant],...ss[size],...props.style}}
    onMouseEnter={e=>e.currentTarget.style.opacity="0.8"}
    onMouseLeave={e=>e.currentTarget.style.opacity="1"}>{children}</button>;
}

function Card({children,style}) {
  return <div style={{background:C.surface,border:`1px solid ${C.border}`,borderRadius:12,padding:20,...style}}>{children}</div>;
}

function Badge({color,children}) {
  return <span style={{background:color+"22",color,border:`1px solid ${color}44`,borderRadius:6,padding:"3px 10px",fontSize:12,fontFamily:"'DM Mono',monospace",fontWeight:600}}>{children}</span>;
}

function Modal({open,onClose,title,children}) {
  if (!open) return null;
  return <div style={{position:"fixed",inset:0,background:"#00000088",zIndex:1000,display:"flex",alignItems:"center",justifyContent:"center",padding:20}} onClick={onClose}>
    <div style={{background:C.surface,border:`1px solid ${C.border}`,borderRadius:16,padding:28,width:"100%",maxWidth:520,maxHeight:"90vh",overflowY:"auto"}} onClick={e=>e.stopPropagation()}>
      <div style={{display:"flex",justifyContent:"space-between",alignItems:"center",marginBottom:20}}>
        <h3 style={{color:C.text,margin:0,fontFamily:"'Fraunces',serif",fontSize:20}}>{title}</h3>
        <button onClick={onClose} style={{background:"none",border:"none",color:C.textMuted,fontSize:20,cursor:"pointer"}}>‚úï</button>
      </div>
      {children}
    </div>
  </div>;
}

// -- Auth --
const MOT_DE_PASSE = "conciergerie2024"; // ‚Üê change ici ton mot de passe

function LoginScreen({onLogin}) {
  const [pwd, setPwd] = useState("");
  const [err, setErr] = useState(false);
  const submit = () => {
    if (pwd === MOT_DE_PASSE) { localStorage.setItem("conc_auth","1"); onLogin(); }
    else { setErr(true); setTimeout(()=>setErr(false), 2000); setPwd(""); }
  };
  return (
    <div style={{minHeight:"100vh",background:C.bg,display:"flex",alignItems:"center",justifyContent:"center",padding:24}}>
      <div style={{background:C.surface,border:`1px solid ${C.border}`,borderRadius:20,padding:40,width:"100%",maxWidth:380,textAlign:"center"}}>
        <div style={{fontSize:48,marginBottom:16}}>üè°</div>
        <h1 style={{fontFamily:"'Fraunces',serif",fontSize:24,color:C.text,marginBottom:6}}>Conciergerie</h1>
        <p style={{color:C.textMuted,fontSize:14,marginBottom:28}}>Acc√®s priv√© ‚Äî Entrez votre mot de passe</p>
        <input
          type="password"
          placeholder="Mot de passe"
          value={pwd}
          onChange={e=>setPwd(e.target.value)}
          onKeyDown={e=>e.key==="Enter"&&submit()}
          style={{...inputStyle, textAlign:"center", fontSize:16, letterSpacing:"0.2em", marginBottom:12,
            borderColor: err ? C.danger : C.border, transition:"border-color 0.2s"}}
          onFocus={e=>e.target.style.borderColor=err?C.danger:C.accent}
          onBlur={e=>e.target.style.borderColor=err?C.danger:C.border}
          autoFocus
        />
        {err && <p style={{color:C.danger,fontSize:13,marginBottom:8}}>Mot de passe incorrect</p>}
        <Btn onClick={submit} style={{width:"100%",justifyContent:"center",marginTop:4}}>Acc√©der ‚Üí</Btn>
      </div>
    </div>
  );
}

// -- App --
export default function App() {
  const [auth, setAuth] = useState(!!localStorage.getItem("conc_auth"));
  if (!auth) return <LoginScreen onLogin={()=>setAuth(true)} />;

  const [tab, setTab] = useState("missions");
  const [prests, setPrests] = useState(DEFAULT_PRESTS);
  const [logs, setLogs] = useState(DEFAULT_LOGS);
  const [missions, setMissions] = useState([]);
  const [modal, setModal] = useState(null);
  const [editTarget, setEditTarget] = useState(null);
  const [toast, setToast] = useState(null);
  const [filter, setFilter] = useState("all");

  const [mForm, setMForm] = useState({});
  const [pForm, setPForm] = useState({});
  const [lForm, setLForm] = useState({});

  useEffect(() => {
    try {
      const p = localStorage.getItem("conc_prests"); if(p) setPrests(JSON.parse(p));
      const l = localStorage.getItem("conc_logs"); if(l) setLogs(JSON.parse(l));
      const m = localStorage.getItem("conc_missions"); if(m) setMissions(JSON.parse(m));
    } catch {}
  }, []);

  const saveP = d => { setPrests(d); try{localStorage.setItem("conc_prests",JSON.stringify(d))}catch{} };
  const saveL = d => { setLogs(d); try{localStorage.setItem("conc_logs",JSON.stringify(d))}catch{} };
  const saveM = d => { setMissions(d); try{localStorage.setItem("conc_missions",JSON.stringify(d))}catch{} };

  const showToast = (msg, color=C.success) => { setToast({msg,color}); setTimeout(()=>setToast(null),3000); };

  const openModal = (type, target=null) => {
    setEditTarget(target);
    if (type==="mission") setMForm(target||{prestataireId:prests[0]?.id||"",logementId:logs[0]?.id||"",date:new Date().toISOString().split("T")[0],heureMission:"09:00",heureDepart:"",heureArrivee:"",dateArrivee:"",cout:"",consignes:""});
    if (type==="prest") setPForm(target||{nom:"",email:"",couleur:"#4f8ef7"});
    if (type==="log") setLForm(target||{nom:"",adresse:"",codeAcces:"",notes:""});
    setModal(type);
  };

  const saveMission = () => {
    if (!mForm.prestataireId||!mForm.logementId||!mForm.date) return;
    const id = editTarget?.id||`m${Date.now()}`;
    const updated = editTarget ? missions.map(m=>m.id===editTarget.id?{...mForm,id}:m) : [...missions,{...mForm,id}];
    saveM(updated); setModal(null); showToast(editTarget?"Mission mise √† jour ‚úì":"Mission cr√©√©e ‚úì");
  };
  const savePrest = () => {
    if (!pForm.nom) return;
    const id = editTarget?.id||`p${Date.now()}`;
    const updated = editTarget ? prests.map(p=>p.id===editTarget.id?{...pForm,id}:p) : [...prests,{...pForm,id}];
    saveP(updated); setModal(null); showToast("Prestataire enregistr√© ‚úì");
  };
  const saveLog = () => {
    if (!lForm.nom) return;
    const id = editTarget?.id||`l${Date.now()}`;
    const updated = editTarget ? logs.map(l=>l.id===editTarget.id?{...lForm,id}:l) : [...logs,{...lForm,id}];
    saveL(updated); setModal(null); showToast("Logement enregistr√© ‚úì");
  };

  const filtered = (filter==="all"?missions:missions.filter(m=>m.prestataireId===filter)).sort((a,b)=>new Date(a.date)-new Date(b.date));

  const tabs = [{id:"missions",label:"üìÖ Missions"},{id:"prests",label:"üë§ Prestataires"},{id:"logs",label:"üè° Logements"}];
  const couleurs = ["#4f8ef7","#2dd4a0","#f7a94f","#f75f9f","#a78bfa","#f75f5f"];

  return (
    <div style={{minHeight:"100vh",background:C.bg,color:C.text}}>
      {toast && <div style={{position:"fixed",top:20,right:20,zIndex:2000,background:toast.color+"22",border:`1px solid ${toast.color}55`,borderRadius:10,padding:"12px 20px",color:toast.color,fontWeight:600,fontSize:14,backdropFilter:"blur(10px)"}}>{toast.msg}</div>}

      {/* Header */}
      <div style={{borderBottom:`1px solid ${C.border}`,background:C.surface}}>
        <div style={{maxWidth:900,margin:"0 auto",padding:"18px 24px",display:"flex",alignItems:"center",justifyContent:"space-between",flexWrap:"wrap",gap:12}}>
          <div>
            <h1 style={{margin:0,fontFamily:"'Fraunces',serif",fontSize:24,letterSpacing:"-0.02em"}}>üè° Conciergerie</h1>
            <p style={{margin:"2px 0 0",fontSize:13,color:C.textMuted}}>Gestion des missions & calendriers prestataires</p>
          </div>
          <div style={{display:"flex",gap:8}}>
            <Badge color={C.accent}>{missions.length} missions</Badge>
            <Badge color={C.success}>{prests.length} prestataires</Badge>
          </div>
        </div>
        <div style={{maxWidth:900,margin:"0 auto",padding:"0 24px",display:"flex",gap:4}}>
          {tabs.map(t=><button key={t.id} onClick={()=>setTab(t.id)} style={{background:"none",border:"none",cursor:"pointer",padding:"10px 16px",fontSize:14,fontFamily:"'DM Sans',sans-serif",fontWeight:600,color:tab===t.id?C.accent:C.textMuted,borderBottom:tab===t.id?`2px solid ${C.accent}`:"2px solid transparent"}}>{t.label}</button>)}
        </div>
      </div>

      <div style={{maxWidth:900,margin:"0 auto",padding:"28px 24px"}}>

        {/* MISSIONS */}
        {tab==="missions" && <>
          <div style={{display:"flex",justifyContent:"space-between",alignItems:"center",marginBottom:20,gap:12,flexWrap:"wrap"}}>
            <select value={filter} onChange={e=>setFilter(e.target.value)} style={{...inputStyle,width:"auto",minWidth:200}}>
              <option value="all">Tous les prestataires</option>
              {prests.map(p=><option key={p.id} value={p.id}>{p.nom}</option>)}
            </select>
            <Btn onClick={()=>openModal("mission")}>+ Nouvelle mission</Btn>
          </div>
          {filtered.length===0
            ? <Card style={{textAlign:"center",padding:48}}><div style={{fontSize:40,marginBottom:12}}>üìÖ</div><p style={{color:C.textMuted}}>Aucune mission pour l'instant</p><Btn style={{marginTop:16}} onClick={()=>openModal("mission")}>Cr√©er la premi√®re mission</Btn></Card>
            : <div style={{display:"flex",flexDirection:"column",gap:10}}>
                {filtered.map(m=>{
                  const prest = prests.find(p=>p.id===m.prestataireId);
                  const log = logs.find(l=>l.id===m.logementId);
                  const date = new Date(m.date+"T12:00:00");
                  return <Card key={m.id} style={{display:"flex",alignItems:"flex-start",gap:16,padding:"16px 20px",flexWrap:"wrap"}}>
                    <div style={{minWidth:52,textAlign:"center"}}>
                      <div style={{fontSize:11,fontFamily:"'DM Mono',monospace",color:C.textDim,textTransform:"uppercase"}}>{date.toLocaleDateString("fr-FR",{month:"short"})}</div>
                      <div style={{fontSize:26,fontWeight:700,lineHeight:1}}>{date.getDate()}</div>
                      <div style={{fontSize:11,color:C.textDim}}>{date.toLocaleDateString("fr-FR",{weekday:"short"})}</div>
                    </div>
                    <div style={{flex:1,minWidth:180}}>
                      <div style={{display:"flex",alignItems:"center",gap:8,flexWrap:"wrap",marginBottom:4}}>
                        <span style={{fontWeight:600,fontSize:15}}>{log?.nom||"?"}</span>
                        {prest && <Badge color={prest.couleur}>{prest.nom}</Badge>}
                      </div>
                      <div style={{fontSize:13,color:C.textMuted}}>{log?.adresse}</div>
                      <div style={{display:"flex",gap:16,marginTop:6,flexWrap:"wrap"}}>
                        {m.heureMission && <span style={{fontSize:12,color:C.textDim}}>üßπ D√©but {m.heureMission}</span>}
                        {m.heureDepart && <span style={{fontSize:12,color:C.textDim}}>üõ´ D√©part {m.heureDepart}</span>}
                        {m.dateArrivee && <span style={{fontSize:12,color:C.textDim}}>üõ¨ Arriv√©e le {new Date(m.dateArrivee+"T12:00:00").toLocaleDateString("fr-FR",{day:"numeric",month:"short"})}{m.heureArrivee?" √† "+m.heureArrivee:""}</span>}
                        {m.cout && <span style={{fontSize:12,color:C.warning,fontFamily:"'DM Mono',monospace",fontWeight:600}}>üí∂ {m.cout}</span>}
                      </div>
                      {m.consignes && <div style={{fontSize:12,color:C.textDim,marginTop:4,fontStyle:"italic"}}>üìù {m.consignes.substring(0,80)}{m.consignes.length>80?"‚Ä¶":""}</div>}
                    </div>
                    <div style={{display:"flex",flexDirection:"column",gap:6,alignItems:"flex-end"}}>
                      <a href={gcalUrl(m,prest,log)} target="_blank" rel="noopener noreferrer"
                        style={{background:"#1a73e822",border:"1px solid #1a73e844",borderRadius:8,padding:"7px 12px",fontSize:12,color:"#4f9ef8",fontWeight:600,display:"inline-flex",alignItems:"center",gap:5,whiteSpace:"nowrap"}}>
                        üìÖ Ajouter √† Google Cal
                      </a>
                      <div style={{display:"flex",gap:6}}>
                        <Btn size="sm" variant="secondary" onClick={()=>openModal("mission",m)}>‚úèÔ∏è</Btn>
                        <Btn size="sm" variant="danger" onClick={()=>{saveM(missions.filter(x=>x.id!==m.id));showToast("Supprim√©e",C.danger);}}>‚úï</Btn>
                      </div>
                    </div>
                  </Card>;
                })}
              </div>
          }
        </>}

        {/* PRESTATAIRES */}
        {tab==="prests" && <>
          <div style={{display:"flex",justifyContent:"flex-end",marginBottom:20}}>
            <Btn onClick={()=>openModal("prest")}>+ Ajouter un prestataire</Btn>
          </div>
          <div style={{display:"flex",flexDirection:"column",gap:10}}>
            {prests.map(p=>{
              const count = missions.filter(m=>m.prestataireId===p.id).length;
              return <Card key={p.id} style={{display:"flex",alignItems:"center",gap:16,flexWrap:"wrap"}}>
                <div style={{width:44,height:44,borderRadius:"50%",background:p.couleur+"33",border:`2px solid ${p.couleur}`,display:"flex",alignItems:"center",justifyContent:"center",fontSize:18,fontWeight:700,color:p.couleur,flexShrink:0}}>
                  {p.nom.charAt(0).toUpperCase()}
                </div>
                <div style={{flex:1,minWidth:120}}>
                  <div style={{fontWeight:600,fontSize:15}}>{p.nom}</div>
                  <div style={{fontSize:13,color:C.textMuted}}>{p.email}</div>
                </div>
                <Badge color={C.accent}>{count} mission{count!==1?"s":""}</Badge>
                <div style={{display:"flex",gap:6,flexWrap:"wrap"}}>
                  <Btn size="sm" variant="success" onClick={()=>{downloadIcal(generateIcal(missions,p,logs),`missions-${p.nom.replace(/\s+/g,"_")}.ics`);showToast(`Calendrier t√©l√©charg√© ‚úì`);}}>‚¨á .ics</Btn>
                  <Btn size="sm" variant="secondary" onClick={()=>openModal("prest",p)}>‚úèÔ∏è</Btn>
                  <Btn size="sm" variant="danger" onClick={()=>saveP(prests.filter(x=>x.id!==p.id))}>‚úï</Btn>
                </div>
              </Card>;
            })}
          </div>
          <Card style={{marginTop:24,background:C.accentMuted,border:`1px solid ${C.accent}33`}}>
            <h4 style={{margin:"0 0 8px",color:C.accentLight,fontFamily:"'Fraunces',serif"}}>üí° Workflow recommand√©</h4>
            <p style={{margin:0,fontSize:13,color:C.textMuted,lineHeight:1.7}}>
              1. Cr√©e un <strong style={{color:C.text}}>Google Calendar par prestataire</strong> dans ton compte Google.<br/>
              2. Partage-lui le <strong style={{color:C.text}}>lien d'abonnement</strong> une seule fois (param√®tres du calendrier ‚Üí lien public).<br/>
              3. Pour chaque mission, clique <strong style={{color:C.text}}>"Ajouter √† Google Cal"</strong> et choisis le bon calendrier ‚Üí √ßa appara√Æt instantan√©ment chez le prestataire.
            </p>
          </Card>
        </>}

        {/* LOGEMENTS */}
        {tab==="logs" && <>
          <div style={{display:"flex",justifyContent:"flex-end",marginBottom:20}}>
            <Btn onClick={()=>openModal("log")}>+ Ajouter un logement</Btn>
          </div>
          <div style={{display:"grid",gap:12,gridTemplateColumns:"repeat(auto-fill,minmax(280px,1fr))"}}>
            {logs.map(l=>{
              const count = missions.filter(m=>m.logementId===l.id).length;
              return <Card key={l.id}>
                <div style={{display:"flex",justifyContent:"space-between",alignItems:"flex-start",marginBottom:12}}>
                  <span style={{fontSize:28}}>üè°</span>
                  <Badge color={C.warning}>{count} mission{count!==1?"s":""}</Badge>
                </div>
                <div style={{fontWeight:700,fontSize:16,marginBottom:4}}>{l.nom}</div>
                <div style={{fontSize:13,color:C.textMuted,marginBottom:8}}>üìç {l.adresse}</div>
                {l.codeAcces && <div style={{background:C.bg,borderRadius:6,padding:"6px 10px",fontFamily:"'DM Mono',monospace",fontSize:13,color:C.warning,marginBottom:8}}>üîë {l.codeAcces}</div>}
                {l.notes && <div style={{fontSize:12,color:C.textDim,fontStyle:"italic",marginBottom:8}}>{l.notes}</div>}
                <div style={{display:"flex",gap:6,marginTop:8}}>
                  <Btn size="sm" variant="secondary" onClick={()=>openModal("log",l)}>‚úèÔ∏è Modifier</Btn>
                  <Btn size="sm" variant="danger" onClick={()=>saveL(logs.filter(x=>x.id!==l.id))}>‚úï</Btn>
                </div>
              </Card>;
            })}
          </div>
        </>}
      </div>

      {/* MODAL MISSION */}
      <Modal open={modal==="mission"} onClose={()=>setModal(null)} title={editTarget?"Modifier la mission":"Nouvelle mission"}>
        <div style={{display:"flex",flexDirection:"column",gap:14}}>
          <Select label="Prestataire" value={mForm.prestataireId||""} onChange={e=>setMForm({...mForm,prestataireId:e.target.value})}>
            {prests.map(p=><option key={p.id} value={p.id}>{p.nom}</option>)}
          </Select>
          <Select label="Logement" value={mForm.logementId||""} onChange={e=>setMForm({...mForm,logementId:e.target.value})}>
            {logs.map(l=><option key={l.id} value={l.id}>{l.nom}</option>)}
          </Select>
          <Input label="Date de la mission" type="date" value={mForm.date||""} onChange={e=>setMForm({...mForm,date:e.target.value})} />
          <div style={{display:"grid",gridTemplateColumns:"1fr 1fr",gap:12}}>
            <Input label="Heure d√©but m√©nage" type="time" value={mForm.heureMission||""} onChange={e=>setMForm({...mForm,heureMission:e.target.value})} />
            <Input label="D√©part locataires" type="time" value={mForm.heureDepart||""} onChange={e=>setMForm({...mForm,heureDepart:e.target.value})} />
          </div>
          <div style={{display:"grid",gridTemplateColumns:"1fr 1fr",gap:12}}>
            <Input label="Date arriv√©e prochains locataires" type="date" value={mForm.dateArrivee||""} onChange={e=>setMForm({...mForm,dateArrivee:e.target.value})} />
            <Input label="Heure d'arriv√©e" type="time" value={mForm.heureArrivee||""} onChange={e=>setMForm({...mForm,heureArrivee:e.target.value})} />
          </div>
          <Input label="Co√ªt de la prestation (‚Ç¨)" type="text" placeholder="ex : 75‚Ç¨ forfait / 3h √ó 20‚Ç¨" value={mForm.cout||""} onChange={e=>setMForm({...mForm,cout:e.target.value})} />
          <Textarea label="Consignes sp√©cifiques" placeholder="Changer les draps ch.1 et 2, inventaire cuisine..." value={mForm.consignes||""} onChange={e=>setMForm({...mForm,consignes:e.target.value})} />
          <div style={{display:"flex",gap:8,justifyContent:"flex-end",marginTop:4}}>
            <Btn variant="secondary" onClick={()=>setModal(null)}>Annuler</Btn>
            <Btn onClick={saveMission}>{editTarget?"Mettre √† jour":"Cr√©er la mission"}</Btn>
          </div>
        </div>
      </Modal>

      {/* MODAL PRESTATAIRE */}
      <Modal open={modal==="prest"} onClose={()=>setModal(null)} title={editTarget?"Modifier le prestataire":"Nouveau prestataire"}>
        <div style={{display:"flex",flexDirection:"column",gap:14}}>
          <Input label="Nom complet" placeholder="Marie Dupont" value={pForm.nom||""} onChange={e=>setPForm({...pForm,nom:e.target.value})} />
          <Input label="Email" type="email" placeholder="marie@example.com" value={pForm.email||""} onChange={e=>setPForm({...pForm,email:e.target.value})} />
          <Field label="Couleur">
            <div style={{display:"flex",gap:8,flexWrap:"wrap",marginTop:4}}>
              {couleurs.map(c=><div key={c} onClick={()=>setPForm({...pForm,couleur:c})} style={{width:32,height:32,borderRadius:"50%",background:c,cursor:"pointer",border:pForm.couleur===c?"3px solid white":"3px solid transparent",transition:"border 0.15s"}} />)}
            </div>
          </Field>
          <div style={{display:"flex",gap:8,justifyContent:"flex-end",marginTop:4}}>
            <Btn variant="secondary" onClick={()=>setModal(null)}>Annuler</Btn>
            <Btn onClick={savePrest}>{editTarget?"Mettre √† jour":"Ajouter"}</Btn>
          </div>
        </div>
      </Modal>

      {/* MODAL LOGEMENT */}
      <Modal open={modal==="log"} onClose={()=>setModal(null)} title={editTarget?"Modifier le logement":"Nouveau logement"}>
        <div style={{display:"flex",flexDirection:"column",gap:14}}>
          <Input label="Nom du logement" placeholder="Villa Les Pins" value={lForm.nom||""} onChange={e=>setLForm({...lForm,nom:e.target.value})} />
          <Input label="Adresse compl√®te" placeholder="12 Rue des Mimosas, 06600 Antibes" value={lForm.adresse||""} onChange={e=>setLForm({...lForm,adresse:e.target.value})} />
          <Input label="Code d'acc√®s / cl√©s" placeholder="A1234# ‚Äî bo√Æte √† cl√©s sous le porche" value={lForm.codeAcces||""} onChange={e=>setLForm({...lForm,codeAcces:e.target.value})} />
          <Textarea label="Notes permanentes" placeholder="Consignes g√©n√©rales valables √† chaque passage..." value={lForm.notes||""} onChange={e=>setLForm({...lForm,notes:e.target.value})} />
          <div style={{display:"flex",gap:8,justifyContent:"flex-end",marginTop:4}}>
            <Btn variant="secondary" onClick={()=>setModal(null)}>Annuler</Btn>
            <Btn onClick={saveLog}>{editTarget?"Mettre √† jour":"Ajouter"}</Btn>
          </div>
        </div>
      </Modal>
    </div>
  );
}

ReactDOM.createRoot(document.getElementById("root")).render(<App />);
</script>
</body>
</html>
